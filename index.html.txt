<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TranslateTube - ØªØ¹Ù„Ù… Ø§Ù„Ù„ØºØ§Øª Ø¹Ø¨Ø± Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨</title>
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #121212; color: white; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        .container { max-width: 900px; width: 100%; }
        h1 { color: #00ff00; text-align: center; }
        
        .video-wrapper { position: relative; width: 100%; padding-top: 56.25%; background: #000; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        /* Ø·Ø¨Ù‚Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø© */
        .overlay-container { position: absolute; bottom: 30px; left: 20px; right: 20px; display: flex; flex-direction: column; gap: 12px; pointer-events: none; }
        .box-group { display: flex; flex-direction: column; }
        .label { font-size: 14px; margin-bottom: 4px; color: #ccc; font-weight: bold; }
        .box { padding: 12px 20px; border-radius: 8px; font-size: 20px; font-weight: 600; width: fit-content; max-width: 90% ; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        .original { background-color: #00ff00; color: #000; } /* Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø®Ø¶Ø± */
        .translation { background-color: #00008b; color: #fff; } /* Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø¯Ø§ÙƒÙ† */

        .controls { margin-top: 25px; display: flex; gap: 10px; width: 100%; }
        input { flex: 1; padding: 12px; border-radius: 5px; border: none; font-size: 16px; }
        button { padding: 12px 25px; background-color: #00ff00; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background-color: #00cc00; }
        #status { margin-top: 10px; color: #888; font-size: 14px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>TranslateTube ğŸ“º</h1>
        
        <div class="video-wrapper">
            <div id="player"></div>
            
            <div class="overlay-container">
                <div class="box-group">
                    <span class="label">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„Ù„ÙÙŠØ¯ÙŠÙˆ</span>
                    <div id="originalText" class="box original">Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...</div>
                </div>
                <div class="box-group">
                    <span class="label">Ø§Ù„Ù„ØºØ© Ø§Ù„ØªØ±Ø¬Ù…Ø©</span>
                    <div id="translatedText" class="box translation">Warten Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø¬Ù…Ø©...</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <input type="text" id="videoUrl" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨ Ù‡Ù†Ø§...">
            <button onclick="loadAndAnalyze()">ØªØ­Ù„ÙŠÙ„ ÙˆØªØ±Ø¬Ù…Ø©</button>
        </div>
        <div id="status"></div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const API_KEY = "AIzaSyACzULF6NC0WFOLbC2d6V-_5CyPv4PuJCw";
        const genAI = new GoogleGenerativeAI(API_KEY);

        window.loadAndAnalyze = async function() {
            const url = document.getElementById('videoUrl').value;
            const status = document.getElementById('status');
            const videoId = extractVideoID(url);

            if (!videoId) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ ØµØ­ÙŠØ­");
                return;
            }

            // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ø§Ù„Ù…Ø´ØºÙ„
            document.getElementById('player').innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" allow="autoplay"></iframe>`;
            
            status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Gemini Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...";

            try {
                // 2. Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Gemini 1.5 Flash (Ø§Ù„Ø£Ø³Ø±Ø¹ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ)
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                
                // Ø¨Ø±ÙˆÙ…Ø¨Øª Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ù…Ù„Ø© ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø©
                const prompt = `Analyze this YouTube video (ID: ${videoId}). 
                Extract one important educational sentence in Arabic.
                Translate it to German.
                Return ONLY a JSON object like this: {"ar": "Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", "de": "Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©"}`;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                const data = JSON.parse(response.text().replace(/```json|```/g, ""));

                // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ù„ÙˆÙ†Ø©
                document.getElementById('originalText').innerText = data.ar;
                document.getElementById('translatedText').innerText = data.de;
                status.innerText = "ØªÙ…Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!";

            } catch (error) {
                console.error(error);
                status.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…ØªØ§Ø­ Ù„Ù„ØªØ¶Ù…ÙŠÙ†.";
            }
        };

        function extractVideoID(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length == 11) ? match[2] : null;
        }
    </script>
</body>
</html>